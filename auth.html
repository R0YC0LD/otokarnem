<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giriş Yap - Oto Karne</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container mt-5" style="max-width: 500px;">
        <div class="card">
            <div class="card-header bg-primary text-white text-center">
                <h4>Hesap Erişimi</h4>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs mb-3" id="authTab" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button">Giriş Yap</button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button">Kayıt Ol</button>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane fade show active" id="login">
                        <form id="loginForm">
                            <div class="mb-3">
                                <label>TC Kimlik No / Usta ID</label>
                                <input type="text" id="loginId" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label>Şifre</label>
                                <input type="password" id="loginPass" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Giriş Yap</button>
                        </form>
                    </div>

                    <div class="tab-pane fade" id="register">
                        <form id="registerForm">
                            <div class="mb-3">
                                <label>Ad Soyad</label>
                                <input type="text" id="regName" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label>TC Kimlik No (11 Hane)</label>
                                <input type="text" id="regTC" class="form-control" maxlength="11" required>
                                <small class="text-muted">Doğrulama yapılacaktır.</small>
                            </div>
                            <div class="mb-3">
                                <label>Şifre Oluştur</label>
                                <input type="password" id="regPass" class="form-control" required>
                            </div>
                            
                            <hr>
                            <h6 class="text-primary">Araç Bilgileri</h6>
                            <div class="mb-3">
                                <input type="text" id="regPlate" class="form-control mb-2" placeholder="Plaka (34ABC12)" required>
                                <input type="text" id="regVin" class="form-control mb-2" placeholder="Şasi No" required>
                                <input type="text" id="regModel" class="form-control" placeholder="Marka Model (Toyota Corolla 2020)" required>
                            </div>

                            <button type="submit" class="btn btn-success w-100">Kayıt Ol ve Arabamı Ekle</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    <script>
        // Kayıt İşlemi
        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const db = getDB();
            
            const name = document.getElementById('regName').value;
            const tc = document.getElementById('regTC').value;
            const pass = document.getElementById('regPass').value;
            
            // Araç Bilgileri
            const car = {
                plate: document.getElementById('regPlate').value,
                vin: document.getElementById('regVin').value,
                model: document.getElementById('regModel').value
            };

            // TC Kontrolü
            if(!validateTC(tc)) {
                alert("Geçersiz TC Kimlik Numarası!");
                return;
            }

            // Kayıt Kontrolü
            if(db.users.find(u => u.tc === tc)) {
                alert("Bu TC ile zaten kayıt var.");
                return;
            }

            // Kaydet
            db.users.push({ tc, name, pass, car });
            saveDB(db);
            alert("Kayıt Başarılı! Giriş yapabilirsiniz.");
            window.location.reload();
        });

        // Giriş İşlemi
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const db = getDB();
            const id = document.getElementById('loginId').value;
            const pass = document.getElementById('loginPass').value;

            // Önce kullanıcıda ara
            const user = db.users.find(u => u.tc === id && u.pass === pass);
            if (user) {
                setCurrentUser(user, 'user');
                window.location.href = 'user-panel.html';
                return;
            }

            // Sonra ustada ara (Usta ID'si 'u1' ve şifre '1234')
            const master = db.masters.find(m => m.id === id && m.pass === pass);
            if (master) {
                setCurrentUser(master, 'master');
                window.location.href = 'master-panel.html';
                return;
            }

            alert("Hatalı Bilgiler!");
        });
    </script>
</body>
</html>
